# Habilitar el motor de ModSecurity
SecRuleEngine On

# Habilitar el motor de ModSecurity
SecRuleEngine On

# Configuración básica
SecRequestBodyAccess On
SecResponseBodyAccess On
SecResponseBodyMimeType text/plain text/html text/xml application/json
SecDataDir /tmp/modsecurity/data

# Protección contra XSS
SecRule REQUEST_COOKIES|!REQUEST_COOKIES:/__utm/|REQUEST_COOKIES_NAMES|ARGS_NAMES|ARGS|XML:/* "@detectXSS" \
    "id:1,\
    phase:2,\
    deny,\
    status:403,\
    msg:'XSS Attack Detected'"

# Protección contra ataques comunes
SecRule REQUEST_URI "@contains ../" \
    "id:2000,phase:1,deny,status:403,msg:'Path Traversal Attack'"

# Rate limiting
SecRule IP:REQUEST_RATE "@gt 100/60" \
    "id:2,\
    phase:1,\
    deny,\
    status:429,\
    msg:'Rate Limit Exceeded'"

# Protección endpoints de autenticación
SecRule REQUEST_URI "@beginsWith /api/authentication/" \
    "id:3000,\
    phase:1,\
    chain"
    SecRule REQUEST_METHOD "!^(?:GET|POST)$" \
        "t:none,\
        deny,\
        status:405,\
        msg:'Método no permitido para autenticación'"

# Prevención SQL Injection
SecRule REQUEST_COOKIES|!REQUEST_COOKIES:/__utm/|REQUEST_COOKIES_NAMES|ARGS_NAMES|ARGS|XML:/* "@detectSQLi" \
    "id:4000,\
    phase:2,\
    deny,\
    status:403,\
    msg:'SQL Injection Detectada'"

# Logging de eventos de seguridad
SecAuditEngine RelevantOnly
SecAuditLog /var/log/modsecurity/audit.log
SecAuditLogParts ABIJDEFHZ